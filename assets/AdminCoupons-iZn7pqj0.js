import{a as g,m as f,M,_ as C,o as c,c as r,b as t,n as w,t as i,j as $,l as d,O as b,q as h,p as N,h as _,F as x,i as E,d as v,r as y}from"./index-UaXM0k-N.js";import{g as m}from"./GetDataStore-cGJkuNBJ.js";import{P as V}from"./PaginationComponent-k1EdlSSv.js";import{A as D}from"./AlertStore-PFZlo7ep.js";import{f as I}from"./flatpickr-AUYHLChs.js";import"./sweetalert2.all-KJ4JeXUd.js";const j={props:["couponInfo","editStatus"],data(){return{url:"",path:"",couponModal:null,dateDom:null,coupon:{is_enabled:0},nowStatus:null,isEniting:!1}},methods:{...g(m,["getRemoteData"]),...g(D,["basicContent"]),editCoupon(e){this.isEniting=!this.isEniting;const{coupon:s,nowStatus:u}=this;s.is_enabled=parseInt(s.is_enabled,10),s.due_date=new Date(s.due_date_str).getTime()/1e3;let p={data:{...s}},o="post";u===2?o="put":u||(p=null,o="delete"),this.axios[o](`${this.url}api/${this.path}/admin/coupon${e?`/${e}`:""}`,p).then(n=>{this.alertStyles.basic.fire({...this.basicContent(n.data.message,1),didClose:()=>{this.$emit("needGetNewData"),this.isEniting=!this.isEniting,this.couponModal.hide()}})}).catch(n=>{this.isEniting=!this.isEniting,this.alertStyles.basic.fire(this.basicContent(n.response.data.message,2))})}},computed:{...f(m,["pagination"]),...f(D,["alertStyles"]),status(){return this.nowStatus?this.nowStatus===2?"編輯":"新增":"刪除"},dueDateStr(){const e=new Date(this.coupon.due_date*1e3),s=`${e.getMonth()+1}`.padStart(2,"0"),u=`${e.getDate()}`.padStart(2,"0");return`${e.getFullYear()}-${s}-${u}`}},watch:{editStatus(e){this.nowStatus=e},couponInfo(e){const s=!Object.keys(e).length;this.coupon=this.$options.data().coupon,s||(this.coupon={...this.coupon,...e})}},mounted(){this.couponModal=new M(this.$refs.couponModal),this.dateDom=this.$refs.dueDate,I(this.dateDom,{minDate:"today",maxDate:new Date().fp_incr(365),wrap:!0}),this.url="https://vue3-course-api.hexschool.io/v2/",this.path="gymplus"}},A={ref:"couponModal",class:"modal fade",id:"couponModal",tabindex:"-1","aria-labelledby":"couponModalLabel","aria-hidden":"true"},U={class:"modal-dialog modal-dialog-centered modal-dialog-scrollable"},P={class:"modal-content"},R={class:"modal-title fs-6 fs-sm-5 fw-medium text-white"},B={key:0,class:"ls-0 small fs-sm-6"},F={class:"modal-body p-5"},G={class:"admin-form container-fluid px-sm-6 d-flex flex-column"},O={class:"row g-3 mb-3 align-items-center"},T=t("label",{for:"title",class:"col-3 form-label"},"標題",-1),L={class:"col"},q={class:"row g-3 mb-3 align-items-center"},z=t("label",{for:"code",class:"col-3 form-label"},"折扣碼",-1),Y={class:"col"},H={class:"row g-3 mb-3 align-items-center"},J=t("label",{for:"percent",class:"col-3 form-label"},"折扣趴數",-1),K={class:"col"},Q={class:"row g-3 mb-3 align-items-center"},W=t("label",{for:"dueDate",class:"col-3 form-label"},"到期日",-1),X={class:"col input-group input-group-sm",ref:"dueDate"},Z=t("button",{class:"btn btn-light",type:"button","data-toggle":""},[t("i",{class:"bi bi-calendar-plus"})],-1),tt=t("button",{class:"btn btn-outline-gray-4 rounded-end-1 text-dark",type:"button","data-clear":""},[t("i",{class:"bi bi-x-lg"})],-1),st={class:"ms-auto"},ot={class:"form-check"},et=t("label",{for:"is_enabled",class:"form-label"},"啟用優惠券",-1),nt={class:"row justify-content-center"},lt={class:"col-9"},at=t("h4",{class:"fs-6 mb-5"},"確定要刪除優惠券？",-1),it={class:"list-group list-group-flush small"},dt={class:"list-group-item px-0"},ct={class:"list-group-item px-0"},rt={class:"ls-0"},ut={class:"list-group-item px-0"},pt={class:"ls-0"},ht={class:"modal-footer border-0 shadow shadow-top"},_t=t("button",{type:"button",class:"btn btn-sm btn-outline-gray-3 flex-grow-1 flex-md-grow-0 me-2","data-bs-dismiss":"modal"}," 關閉視窗 ",-1),mt=["disabled"],bt={class:"line-loading-loop bg-white"};function gt(e,s,u,p,o,n){return c(),r("div",A,[t("div",U,[t("div",P,[t("div",{class:w(["modal-header py-3",[n.status==="刪除"?"bg-linear-danger":"bg-linear"]])},[t("h3",R,[t("span",null,i(n.status)+"優惠券",1),o.coupon.id?(c(),r("span",B,"："+i(o.coupon.id),1)):$("",!0)])],2),t("div",F,[d(t("div",null,[t("form",G,[t("div",O,[T,t("div",L,[d(t("input",{type:"text",id:"title",class:"form-control form-control-sm",placeholder:"請輸入標題","onUpdate:modelValue":s[0]||(s[0]=l=>o.coupon.title=l)},null,512),[[h,o.coupon.title]])])]),t("div",q,[z,t("div",Y,[d(t("input",{type:"text",id:"code",class:"form-control form-control-sm",placeholder:"請輸入折扣代碼","onUpdate:modelValue":s[1]||(s[1]=l=>o.coupon.code=l)},null,512),[[h,o.coupon.code]])])]),t("div",H,[J,t("div",K,[d(t("input",{type:"number",id:"percent",class:"form-control form-control-sm",placeholder:"請輸入折扣趴數","onUpdate:modelValue":s[2]||(s[2]=l=>o.coupon.percent=l),min:"0"},null,512),[[h,o.coupon.percent,void 0,{number:!0}]])])]),t("div",Q,[W,t("div",X,[d(t("input",{type:"text",id:"dueDate","data-input":"",class:"form-control",placeholder:"請輸入到期日","onUpdate:modelValue":s[3]||(s[3]=l=>o.coupon.due_date_str=l)},null,512),[[h,o.coupon.due_date_str]]),Z,tt],512)]),t("div",st,[t("div",ot,[d(t("input",{type:"checkbox",id:"is_enabled",class:"form-check-input","onUpdate:modelValue":s[4]||(s[4]=l=>o.coupon.is_enabled=l),"true-value":"1","false-value":"0"},null,512),[[N,o.coupon.is_enabled]]),et])])])],512),[[b,n.status!=="刪除"]]),d(t("div",nt,[t("div",lt,[at,t("ul",it,[t("li",dt,"優惠券標題："+i(o.coupon.title),1),t("li",ct,[_(" 優惠券編號： "),t("span",rt,i(o.coupon.id),1)]),t("li",ut,[_(" 到期日： "),t("span",pt,i(n.dueDateStr),1)])])])],512),[[b,n.status==="刪除"]])]),t("div",ht,[_t,t("button",{type:"button",class:w(["btn btn-sm flex-grow-1 flex-md-grow-0",[n.status==="刪除"?"btn-danger":"btn-gray-1"]]),onClick:s[5]||(s[5]=l=>n.editCoupon(o.coupon.id)),disabled:o.isEniting},[d(t("span",bt,null,512),[[b,o.isEniting]]),_(" "+i(n.status==="編輯"?"更新":n.status)+"優惠券 ",1)],10,mt)])])])],512)}const ft=C(j,[["render",gt]]),wt={components:{PaginationComponent:V,CouponModal:ft},data(){return{coupons:[],couponInfo:{},editStatus:null}},methods:{...g(m,["getRemoteData"]),getCoupon(e,s){this.couponInfo=e,this.editStatus=s},getNewData(){const e=this.pagination.current_page;this.getRemoteData("coupons",e,!1)}},computed:{...f(m,["targetData","pagination"])},watch:{targetData(e){this.coupons=e}},mounted(){this.getRemoteData("coupons",1,!1)}},xt={class:"container"},vt=t("h2",{class:"fs-3 fw-normal ls-0 mb-md-0 text-center"},[t("span",null,"優惠券管理")],-1),yt={class:"text-center text-md-end mb-3"},Dt=t("span",{class:"icon-base icon-sm icon-add me-1 bg-white align-text-top"},null,-1),Ct=t("span",null,"新增優惠券",-1),St=[Dt,Ct],kt={key:0,class:"table-responsive mb-5"},Mt={class:"table table-hover text-center align-middle ls-0",style:{"min-width":"620px"}},$t=t("thead",null,[t("tr",{class:"table-gray-4"},[t("th",{scope:"col",width:"52px"}),t("th",{scope:"col",class:"d-none d-lg-table-cell",width:"220px"},"編號"),t("th",{scope:"col"},"標題"),t("th",{scope:"col"},"代碼"),t("th",{scope:"col"},"折扣趴數"),t("th",{scope:"col"},"到期日"),t("th",{scope:"col",width:"90px"},"適用狀態"),t("th",{scope:"col",width:"75px"})])],-1),Nt=["onClick"],Et=t("span",{class:"icon-base icon-sm icon-trash"},null,-1),Vt=[Et],It={class:"fs-8 fs-lg-7 ls-0 text-start d-none d-lg-table-cell"},jt={class:"small fs-lg-7 fw-normal mb-0"},At={class:"small fs-lg-7"},Ut={class:"fw-semibold"},Pt={class:"fs-8 fs-lg-7 ls-0"},Rt={class:"fs-7 fs-lg-6"},Bt=["onClick"],Ft={key:1},Gt=t("h2",{class:"fs-6 fw-light text-center"},[t("span",{class:"line-loading-loop bg-gray-3 align-top"}),_(" 資料讀取中請稍後 ")],-1),Ot=[Gt];function Tt(e,s,u,p,o,n){const l=y("PaginationComponent"),S=y("CouponModal");return c(),r(x,null,[t("div",xt,[vt,t("div",yt,[t("button",{type:"button",class:"btn btn-gray-3 py-1 shadow-sm","data-bs-toggle":"modal","data-bs-target":"#couponModal",onClick:s[0]||(s[0]=a=>n.getCoupon({},1))},St)]),o.coupons.length!==0?(c(),r("div",kt,[t("table",Mt,[$t,t("tbody",null,[(c(!0),r(x,null,E(o.coupons,a=>(c(),r("tr",{key:a.id},[t("td",null,[t("button",{type:"button",class:"btn btn-sm btn-outline-danger border-0 p-1","data-bs-toggle":"modal","data-bs-target":"#couponModal",onClick:k=>n.getCoupon(a,0)},Vt,8,Nt)]),t("td",It,i(a.id),1),t("td",null,[t("h3",jt,i(a.title),1)]),t("td",At,i(a.code),1),t("td",Ut,i(a.percent),1),t("td",Pt,i(a.due_date_str),1),t("td",null,[t("p",Rt,[t("span",{class:w(["badge",{"bg-success":a.is_enabled,"bg-danger":!a.is_enabled}])},i(a.is_enabled?"可使用":"已禁用"),3)])]),t("td",null,[t("button",{type:"button",class:"btn btn-sm py-1 btn-outline-dark fw-normal","data-bs-toggle":"modal","data-bs-target":"#couponModal",onClick:k=>n.getCoupon(a,2)}," 編輯 ",8,Bt)])]))),128))])])])):(c(),r("div",Ft,Ot)),v(l,{"now-target":"coupons","is-user":!1})]),v(S,{"coupon-info":o.couponInfo,"edit-status":o.editStatus,onNeedGetNewData:n.getNewData},null,8,["coupon-info","edit-status","onNeedGetNewData"])],64)}const Kt=C(wt,[["render",Tt]]);export{Kt as default};
