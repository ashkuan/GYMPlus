import{a as v,m as u,_ as N,o as n,c,b as e,t as d,e as V,l as r,q as b,v as P,F as g,i as _,p as k,j as w,O as x,h as y,d as $,r as C,n as E}from"./index-UaXM0k-N.js";import{g as A}from"./GetDataStore-cGJkuNBJ.js";import{f as S}from"./FakeDataStore-tuvo3h1B.js";import{P as T}from"./PaginationComponent-k1EdlSSv.js";import{a as I}from"./AdminCourseStore-6lGyLqQo.js";import{A as D}from"./AlertStore-PFZlo7ep.js";import"./sweetalert2.all-KJ4JeXUd.js";const U={props:["isAddNew","getNewData"],data(){return{url:"",path:"",singleArticle:{author:"",tag:[],isPublic:!1},isEniting:!1}},methods:{...v(A,["getRemoteData"]),...v(I,["getImgFile","uploadImg"]),...v(D,["basicContent"]),resetTemp(){this.singleArticle=this.$options.data().singleArticle},editArticle(i,t){this.isEniting=!this.isEniting;const m={...this.singleArticle};m.create_at=Math.floor(new Date().getTime()/1e3);let h={data:{...m}},s="post";i&&t.type==="submit"?s="put":t.type==="click"&&(h=null,s="delete"),this.axios[s](`${this.url}api/${this.path}/admin/article${i?`/${i}`:""}`,h).then(a=>{this.alertStyles.basic.fire({...this.basicContent(a.data.message,1),didClose:()=>{this.resetTemp(),this.getNewData(),this.isEniting=!this.isEniting}})}).catch(a=>{this.isEniting=!this.isEniting,this.alertStyles.basic.fire(this.basicContent(a.response.data.message,2))})}},computed:{...u(S,["coaches","articleTags"]),...u(A,["singleInfo"]),...u(I,["temp","isAddingImg"]),...u(D,["alertStyles"]),checkedtags(){return this.articleTags.map(i=>{const{tags:t}=this.singleArticle;let m=!1;return t&&t.forEach(h=>{h===i&&(m=!0)}),m})}},watch:{singleInfo(i){this.singleArticle={...i}},isAddingImg(i){i||(this.singleArticle.image=this.temp.imageUrl)},isAddNew(i){i&&this.resetTemp()}},mounted(){this.url="https://vue3-course-api.hexschool.io/v2/",this.path="gymplus"}},M={class:"text-center fs-6 fs-sm-5 fw-medium bg-linear text-white py-3 rounded-top-3"},B={class:"px-5 pb-4"},j={class:"row g-1 align-items-center mb-3"},F=e("label",{for:"title",class:"col-2 form-label"},"文章標題",-1),R={class:"col"},G={class:"row g-1 align-items-center mb-3"},O=e("label",{for:"author",class:"col-2 form-label"},"作者",-1),Y={class:"col"},q=e("option",{value:"",disabled:"",hidden:""},"選擇文章作者",-1),z=e("option",{value:"GYM+"},"健身房營運",-1),L=["value"],H={class:"row g-1 mb-3"},J=e("label",{class:"col-3 col-md-2 form-label"},"分類標籤",-1),K={class:"col d-flex flex-wrap"},Q=["checked","value","onUpdate:modelValue","id"],W=["for"],X=e("hr",null,null,-1),Z={class:"row mb-3"},ee={class:"col-8"},se=e("label",{for:"img",class:"form-label mb-2"},"主要圖片",-1),te={class:"input-group input-group-sm"},ie=["disabled"],le={key:0,class:"line-loading-loop bg-white"},oe={key:1},ne={class:"col"},ce={class:"position-relative mb-2 h-100"},ae=["src"],re={class:"img-mask d-flex border"},de={key:0,class:"mx-auto my-auto fs-8"},me=e("hr",null,null,-1),ge={class:"mb-3"},he=e("label",{for:"description",class:"form-label mb-2"},"文章引言",-1),ue={class:"mb-5"},_e=e("label",{for:"content",class:"form-label mb-2"},"文章內文",-1),pe={class:"d-flex flex-row-reverse mb-3"},fe={class:"form-check"},be=e("label",{for:"isPublic",class:"form-label"},"公開文章",-1),ve={class:"text-center"},Ae=["disabled"],we={class:"line-loading-loop bg-white"},ye=["disabled"],ke={class:"line-loading-loop bg-white"};function xe(i,t,m,h,s,a){var f;return n(),c(g,null,[e("h4",M,d((f=s.singleArticle)!=null&&f.id?"編輯":"新增")+"文章 ",1),e("div",B,[e("form",{class:"admin-form",onSubmit:t[9]||(t[9]=V(l=>a.editArticle(s.singleArticle.id,l),["prevent"]))},[e("div",j,[F,e("div",R,[r(e("input",{type:"text",id:"title",class:"form-control form-control-sm",placeholder:"請輸入文章標題","onUpdate:modelValue":t[0]||(t[0]=l=>s.singleArticle.title=l)},null,512),[[b,s.singleArticle.title]])])]),e("div",G,[O,e("div",Y,[r(e("select",{class:"form-select form-select-sm",id:"author","onUpdate:modelValue":t[1]||(t[1]=l=>s.singleArticle.author=l)},[q,z,(n(!0),c(g,null,_(Object.keys(i.coaches),l=>(n(),c("option",{value:l,key:l},d(l),9,L))),128))],512),[[P,s.singleArticle.author]])])]),e("div",H,[J,e("div",K,[(n(!0),c(g,null,_(i.articleTags,(l,o)=>(n(),c("div",{class:"form-check me-2",key:l},[r(e("input",{class:"form-check-input",checked:a.checkedtags[o],value:l,"onUpdate:modelValue":p=>s.singleArticle.tag=p,type:"checkbox",id:`tag${o}`},null,8,Q),[[k,s.singleArticle.tag]]),e("label",{class:"form-label",for:`tag${o}`},d(l),9,W)]))),128))])]),X,e("div",Z,[e("div",ee,[se,r(e("input",{type:"text",id:"img",class:"form-control form-control-sm mb-2",placeholder:"請輸入主要圖片網址","onUpdate:modelValue":t[2]||(t[2]=l=>s.singleArticle.image=l)},null,512),[[b,s.singleArticle.image]]),e("div",te,[e("input",{type:"file",id:"img",ref:"fileInput",class:"form-control form-control-sm fs-8",onChange:t[3]||(t[3]=(...l)=>i.getImgFile&&i.getImgFile(...l))},null,544),e("button",{class:"btn btn-outline-gray-3 ls-2 fs-8",type:"button",onClick:t[4]||(t[4]=l=>i.uploadImg(!1,i.$refs.fileInput)),disabled:i.isAddingImg},[i.isAddingImg?(n(),c("span",le)):(n(),c("span",oe,"新增圖片"))],8,ie)])]),e("div",ne,[e("div",ce,[s.singleArticle.image?(n(),c("img",{key:0,src:s.singleArticle.image,alt:"主要圖片",class:"img-fluid w-100 h-100 rounded-2"},null,8,ae)):w("",!0),e("div",re,[s.singleArticle.image?w("",!0):(n(),c("p",de,"缺少主圖"))])])])]),me,e("div",ge,[he,r(e("textarea",{id:"description",class:"form-control form-control-sm",placeholder:"請輸入文章引言","onUpdate:modelValue":t[5]||(t[5]=l=>s.singleArticle.description=l),style:{height:"58px"}},null,512),[[b,s.singleArticle.description]])]),e("div",ue,[_e,r(e("textarea",{id:"content",class:"form-control form-control-sm",placeholder:"請輸入文章內文","onUpdate:modelValue":t[6]||(t[6]=l=>s.singleArticle.content=l),style:{height:"121px"}},null,512),[[b,s.singleArticle.content]])]),e("div",pe,[e("div",fe,[r(e("input",{type:"checkbox",id:"isPublic",class:"form-check-input","onUpdate:modelValue":t[7]||(t[7]=l=>s.singleArticle.isPublic=l)},null,512),[[k,s.singleArticle.isPublic]]),be])]),e("div",ve,[e("button",{type:"submit",class:"btn btn-sm btn-gray-1 flex-grow-1 flex-lg-grow-0 mx-2",disabled:s.isEniting},[r(e("span",we,null,512),[[x,s.isEniting]]),y(" "+d(s.singleArticle.id?"更新文章":"新增文章"),1)],8,Ae),s.singleArticle.id?(n(),c("button",{key:0,type:"button",class:"btn btn-sm btn-outline-danger flex-grow-1 flex-lg-grow-0 mx-2",onClick:t[8]||(t[8]=l=>a.editArticle(s.singleArticle.id,l)),disabled:s.isEniting},[r(e("span",ke,null,512),[[x,s.isEniting]]),y(" 刪除文章 ")],8,ye)):w("",!0)])],32)])],64)}const $e=N(U,[["render",xe]]),Ce={components:{ArticleEditBlock:$e,PaginationComponent:T},data(){return{articles:[],isAddNew:!0}},methods:{...v(A,["getRemoteData","getSingleInfo"]),getNewData(){const i=this.pagination.current_page;this.getRemoteData("articles",i,!1)}},computed:{...u(A,["targetData","pagination","isGettingInfo"]),...u(S,["coaches","articleTags"])},watch:{targetData(i){this.articles=i}},mounted(){this.getRemoteData("articles",1,!1)}},Ee={class:"container mb-6"},Ie=e("h2",{class:"fs-3 fw-normal ls-0 text-center"},"文章管理",-1),De={class:"d-flex justify-content-between align-items-center mb-3"},Ne={class:"row gx-3 align-items-center"},Se=e("label",{for:"img",class:"col-2 col-xl-3 form-label pe-0"},"文章篩選",-1),Ve={class:"col ps-0"},Pe={class:"form-select form-select-sm"},Te=e("option",{selected:"",hidden:""},"依類別",-1),Ue=e("option",{value:"全部"},"全部",-1),Me=["value"],Be={class:"col"},je={class:"form-select form-select-sm"},Fe=e("option",{selected:"",hidden:""},"依作者",-1),Re=e("option",{value:"GYM+"},"健身房營運",-1),Ge=["value"],Oe=e("div",null,null,-1),Ye=e("span",{class:"icon-base icon-sm icon-add me-1 bg-white align-text-top"},null,-1),qe=e("span",null,"新增文章",-1),ze=[Ye,qe],Le={key:0},He=e("small",{class:"text-muted fs-8 small-md"},"點擊後可進行編輯或刪除",-1),Je={class:"row"},Ke={class:"col-6"},Qe={class:"list-group mb-5"},We=["onClick"],Xe=["src","alt"],Ze={class:"ms-3 me-auto"},es={class:"mb-0 small fs-lg-7"},ss={class:"card-text"},ts={class:"text-muted fs-8 small-md"},is={class:"col-6"},ls={class:"shadow-sm rounded-3"},os={key:1},ns=e("h2",{class:"fs-6 fw-light text-center"},[e("span",{class:"line-loading-loop bg-gray-3 align-top"}),y(" 資料讀取中請稍後 ")],-1),cs=[ns];function as(i,t,m,h,s,a){const f=C("PaginationComponent"),l=C("ArticleEditBlock");return n(),c("div",Ee,[Ie,e("div",De,[e("div",Ne,[Se,e("div",Ve,[e("select",Pe,[Te,Ue,(n(!0),c(g,null,_(i.articleTags,o=>(n(),c("option",{value:o,key:o},d(o),9,Me))),128))])]),e("div",Be,[e("select",je,[Fe,Re,(n(!0),c(g,null,_(Object.keys(i.coaches),o=>(n(),c("option",{value:o,key:o},d(o),9,Ge))),128))])])]),Oe,e("button",{type:"button",class:"btn btn-gray-3 py-1 shadow-sm",onClick:t[0]||(t[0]=o=>s.isAddNew=!0)},ze)]),s.articles.length!==0?(n(),c("div",Le,[He,e("div",Je,[e("div",Ke,[e("div",Qe,[(n(!0),c(g,null,_(s.articles,o=>(n(),c("button",{type:"button",class:"list-group-item list-group-item-action d-flex align-items-center",key:o.id,onClick:p=>(i.getSingleInfo("article",o.id,!1),s.isAddNew=!s.isAddNew)},[e("img",{src:o.image,alt:o.title,class:"rounded-2",style:{width:"120px",height:"80px"}},null,8,Xe),e("div",Ze,[e("h3",es,d(o.title),1),(n(!0),c(g,null,_(o.tag,p=>(n(),c("span",{class:"badge bg-primary bg-opacity-50 fw-light me-2",key:p},d(p),1))),128)),e("p",ss,[e("small",ts,"作者："+d(o.author),1)])]),e("span",{class:E(["badge p-1 rounded-circle ms-5",[o.isPublic?"bg-success":"bg-danger"]])},[e("i",{class:E(["bi",[o.isPublic?"bi-eye-fill":"bi-eye-slash"]])},null,2)],2)],8,We))),128))]),$(f,{"now-target":"articles","is-user":!1})]),e("div",is,[e("div",ls,[$(l,{"is-add-new":s.isAddNew,"get-new-data":a.getNewData},null,8,["is-add-new","get-new-data"])])])])])):(n(),c("div",os,cs))])}const ps=N(Ce,[["render",as]]);export{ps as default};
